<!DOCTYPE html>
<html>

<head>
   <title>robox.js</title>

   <script src="../thirdparty/mqttws31.js"></script>
   <script src="../thirdparty/mqtt-client.js"></script>
   <script src="../communication/message.js"></script>
   <script src="../communication/mqttAdapter.js"></script>
   <script src="../communication/jsonProtocol.js"></script>
   <script src="../communication/webSocketAdapter.js"></script>
   <script src="../component/led.js"></script>
   <script src="../component/motor.js"></script>
   <script src="../component/motorPair.js"></script>
   <script src="../component/servo.js"></script>
   <script src="../robox.js"></script>
</head>

<body>

   <script>
      var myRobox = new Robox();

      myRobox.onConnected = function()
      {
         console.log("Robox connected.");
      }

      myRobox.onDisconnected = function()
      {
         console.log("Robox disconnected.");
      }

      myRobox.handleMessage = function(message)
      {
         console.log(message.messageId);
      }

      function scout()
      {
         var message = new Message();
         message.messageId = "enable";
         message.destination = "scout";

         myRobox.sendMessage(message);
      }

      function blink(on)
      {
         if (on)
         {
            myRobox.components['statusLed'].pulse(1000);
         }
         else
         {
            myRobox.components['statusLed'].setBrightness(0);
         }
      }

      function getRoboxAddress()
      {
         return (document.getElementById("roboxAddress").value);
      }
      
      function limit()
      {
         var limitMin = document.getElementById("limit-min").value;
         var limitMax = document.getElementById("limit-max").value;
         
         myRobox.components["servo1"].limit(limitMin, limitMax);
      }
      
      function reverse()
      {
         var isReversed = document.getElementById("is-reversed").checked;
         
         myRobox.components["servo1"].reverse(isReversed);
      }
      
      function limitMotor()
      {
         var limitMin = document.getElementById("motor-limit-min").value;
         var limitMax = document.getElementById("motor-limit-max").value;
         
         myRobox.components["motor1"].limit(limitMin, limitMax);
      }
      
      function reverseMotor()
      {
         var isReversed = document.getElementById("motor-is-reversed").checked;
         
         myRobox.components["motor1"].reverse(isReversed);
      }
   </script>

   <h1>Robot Controller</h1>

   <div>Robox address: <input type="text" id="roboxAddress" value="192.168.0.105"></div>
   <div>Camera address: <input type="text" id="camAddress"></div>

   <button onclick="myRobox.connect(getRoboxAddress(), 1975)">Connect</button>
   <button onclick="myRobox.connect('broker.hivemq.com', 8000, 'robox/jasontost@gmail.com/godzooki')">MQTT Connect</button>
   <button onclick="myRobox.disconnect()">Disconnect</button>
   <!--button onclick="myRobox.ping()">Ping</button-->

   <br><br>

   <button onmousedown="myRobox.components['motor1'].drive(100)" onmouseup="myRobox.components['motor1'].stop()">Motor 1</button>
   <input id="motor-limit-min" type="number" value="0" onchange="limitMotor();">Min</input>
   <input id="motor-limit-max" type="number" value="100" onchange="limitMotor();">Max</input>
   <input id="motor-is-reversed" type="checkbox" name="isReversed" value="true" onchange="reverseMotor();">isReversed</input>
   
   <br><br>
      
   <button onmousedown="myRobox.components['motor2'].drive(100)" onmouseup="myRobox.components['motor2'].stop()">Motor 2</button>

   <br><br>

   <button onmousedown="myRobox.components['servo1'].rotate(180)" onmouseup="myRobox.components['servo1'].rotate(0)">Servo 1</button>
   <input id="limit-min" type="number" value="0" onchange="limit();">Min</input>
   <input id="limit-max" type="number" value="180" onchange="limit();">Max</input>
   <input id="is-reversed" type="checkbox" name="isReversed" value="true" onchange="reverse();">isReversed</input>
   
   <br><br>
   
   <button onmousedown="myRobox.components['servo2'].rotate(170)" onmouseup="myRobox.components['servo2'].rotate(10)">Servo 2</button>
   
   <br><br>

   <button onmousedown="scout()">Scout</button>

   <button onmousedown="blink(true)" onmouseup="blink(false)">Led</button>

   <br><br>

   <table>
      <tr>
         <td></td>
         <td><button onmousedown="myRobox.components['motorPair'].drive(100, 0)" onmouseup="myRobox.components['motorPair'].stop()">Up</button></td>
         <td></td>
      <tr>
         <td><button onmousedown="myRobox.components['motorPair'].rotate(100)" onmouseup="myRobox.components['motorPair'].stop()">Left</button></td>
         <td></td>
         <td><button onmousedown="myRobox.components['motorPair'].rotate(-100, 0)" onmouseup="myRobox.components['motorPair'].stop()">Right</button></td>
      </tr>
      <tr>
         <td></td>
         <td><button onmousedown="myRobox.components['motorPair'].drive(-100, 0)" onmouseup="myRobox.components['motorPair'].stop()">Down</button></td>
         <td></td>
      </tr>
   </table>

   <input name="code" type="text" />
   <button onclick="eval(document.getElementsByName('code')[0].value)">Evaluate</button>

   <!--div>
      <iframe id="video-iframe" src="http://192.168.0.107:8080/browserfs.html" width="640px" height="480px"></iframe>
   </div-->

</body>

</html>